# 2025-01-20: ペーストデバッグシステムの実装

## 実装内容

包括的なペーストデバッグシステムを実装しました。

### 1. PasteDebugger クラス
- フローティングデバッグパネル（Ctrl+Shift+Pで表示/非表示）
- リアルタイムでペーストフローを追跡
- 色分けされたイベントログ

### 2. デバッグポイント
- **ZeamiTerminal**: データ送信、マーカー検出
- **ZeamiTermManager**: ペーストイベント、xterm.js設定
- **FlowController**: チャンク処理、キューサイズ

### 3. 重要な修正
- `bracketedPasteMode: true` に戻した（必須）
- onPasteハンドラーでデフォルト処理を許可（return true）
- xterm.jsにブラケットペースト処理を任せる

## デバッグで確認すべき項目

1. **ペースト開始時**
   - xterm.jsがペーストイベントを検出しているか
   - ブラケットペーストマーカーが送信されているか

2. **データフロー**
   - データがPTYに到達しているか
   - チャンク分割が適切か
   - フロー制御でブロックされていないか

3. **Claude Code側**
   - 「Pasting text...」が表示される条件
   - ペーストが完了しない理由
   - エンドマーカーが受信されているか

## 使用方法
1. ZeamiTermを起動
2. Ctrl+Shift+Pでデバッグパネルを表示
3. ペースト操作を実行
4. ログを確認して問題箇所を特定