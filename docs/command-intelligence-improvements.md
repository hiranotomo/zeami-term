# Command Intelligence Hub 改善内容

## 実装した修正

### 1. 文字化け問題の改善
- OSC 633 CommandLineから直接コマンドテキストを取得
- バッファ読み取り時の文字化け検出と修正
- 日本語環境でのエンコーディング問題に対応

### 2. Claude Codeセッション検出
- Claude Code起動の自動検出
- セッション中のコマンドをClaude Codeとして分類
- UI出力パターンによる検出

### 3. ターミナル識別の改善
- TimelineViewでターミナルラベルとウィンドウ番号を表示
- 各コマンドがどのターミナルから実行されたか明確に

## 残っている課題

### Claude Code内のコマンド追跡
Claude Codeは独自のターミナル環境を持っており、標準的なOSCシーケンスを送信しません。
以下の対策が考えられます：

1. **Claude Code APIとの統合**
   - Claude Code側でコマンド実行時にカスタムイベントを送信
   - ZeamiTermがそれを受信して記録

2. **出力パターン解析**
   - Claude Codeの出力形式を解析
   - コマンド実行パターンを検出

3. **プロキシアプローチ**
   - Claude Codeのコマンド実行をラップ
   - 実行前後でOSCシーケンスを挿入

## 使用方法

### 文字化け問題の確認
```bash
# ターミナルで日本語コマンドを実行
echo "こんにちは"
```

### Claude Codeセッション検出の確認
```bash
# Claude Codeを起動
claude

# セッション検出ログを確認（開発者ツール）
# [ShellIntegrationAddon] Claude Code session detected
```

### ターミナル識別の確認
1. Command Intelligence Hub を開く（⌘+Shift+H）
2. タイムラインビューに切り替え
3. 各スイムレーンにターミナル情報が表示される

## 今後の改善案

1. **リアルタイムフィルタリング**
   - ターミナル別フィルタ
   - 実行者別フィルタ（Human/Claude Code）
   - 時間範囲フィルタ

2. **詳細情報の表示**
   - コマンドの完全な出力
   - 環境変数
   - 作業ディレクトリ

3. **統計分析の強化**
   - コマンド使用頻度
   - エラー率の推移
   - 実行時間の分析

4. **エクスポート機能**
   - CSV/JSON形式でのエクスポート
   - レポート生成
   - 共有機能