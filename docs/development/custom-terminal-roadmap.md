# ZeamiTerm カスタムターミナル実装ロードマップ

## 目標

VS Codeのターミナル実装から学びつつ、**選択透明度問題を根本的に解決**し、Claude Codeとの深い統合を実現する独自ターミナルを開発する。

## なぜ独自実装か？

1. **xterm.jsの限界**
   - 選択色の透明度がサポートされていない
   - カスタマイズの柔軟性に限界
   - 外部からのパッチでは根本解決不可能

2. **VS Codeから学んだこと**
   - 独自レンダラーによる完全な制御
   - 拡張APIによるエコシステム
   - パフォーマンスの最適化手法

3. **ZeamiTermの独自要件**
   - Claude Code出力の特殊処理
   - AI統合機能
   - Zeamiエコシステムとの連携

## フェーズ別実装計画

### Phase 1: プロトタイプ（完了）
- ✅ Canvas 2Dによる基本レンダリング
- ✅ 透明な選択範囲の実装
- ✅ 基本的なテキスト表示
- ✅ マウスによる選択

### Phase 2: コア機能（1週間）
- [ ] PTY統合（node-pty）
- [ ] ANSIエスケープシーケンス完全対応
- [ ] スクロールバッファ
- [ ] リサイズ対応
- [ ] 日本語入力（IME）

### Phase 3: パフォーマンス最適化（1週間）
- [ ] WebGLレンダラー
- [ ] 差分レンダリング
- [ ] Virtual Scrolling
- [ ] Worker Thread活用

### Phase 4: Claude Code統合（1週間）
- [ ] 出力パーサー統合
- [ ] インライン提案
- [ ] 構造化表示
- [ ] 双方向通信

### Phase 5: 拡張システム（2週間）
- [ ] プラグインAPI
- [ ] テーマシステム
- [ ] キーバインディング
- [ ] VS Code互換性レイヤー

## 技術スタック

### レンダリング
```javascript
// 段階的アプローチ
1. Canvas 2D（現在） - シンプル、十分高速
2. WebGL（将来） - 最高パフォーマンス
3. WebGPU（実験的） - 次世代標準
```

### アーキテクチャ
```
Main Process
  ├── PTY Manager
  ├── Session Manager
  └── IPC Router

Renderer Process
  ├── Terminal Core
  ├── Render Engine
  │   ├── Canvas Renderer
  │   └── WebGL Renderer
  ├── Input Handler
  └── Extension Host
```

## 移行戦略

### 段階1: 並行開発
- 既存のxterm.js版を維持
- カスタム版を別オプションとして提供
- フィードバック収集

### 段階2: 機能パリティ
- すべての既存機能を実装
- パフォーマンステスト
- バグ修正

### 段階3: 切り替え
- カスタム版をデフォルトに
- xterm.js版は互換性オプション
- 最終的に完全移行

## 期待される成果

1. **完全な制御**
   - 選択透明度問題の根本解決
   - あらゆるカスタマイズが可能

2. **優れたパフォーマンス**
   - VS Code同等以上の速度
   - メモリ効率の改善

3. **革新的な機能**
   - AI深層統合
   - 独自の視覚効果
   - 新しいインタラクション

## リスクと対策

### リスク
- 開発期間の長期化
- バグの増加
- 互換性問題

### 対策
- 段階的リリース
- 徹底的なテスト
- コミュニティフィードバック
- xterm.jsフォールバック

## 結論

xterm.jsの制約から解放され、真に革新的なターミナルエミュレータを作ることができます。VS Codeが示した道を参考に、さらに先進的な実装を目指します。

選択透明度は氷山の一角に過ぎません。独自実装により、ターミナルエミュレータの新しい可能性を切り開きます。