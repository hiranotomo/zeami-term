# 2025-06-28: ペースト処理のフリーズ問題修正

## 問題の概要
ZeamiTermで長いテキストをクリップボードからペーストした際に、以下の問題が発生：
1. `ReferenceError: id is not defined`エラーが頻発
2. アプリケーションがフリーズ状態になる
3. 一文字ずつ処理されるため、パフォーマンスが極端に低下

## 原因
### 1. 未定義変数の参照
`ZeamiTermManager.js`の484行目で、`session.terminal.onData`のコールバック内で未定義の`id`変数を使用していた：
```javascript
this.sessionPersistence.saveSession(id, session.terminal, session.process);
```

### 2. ペースト処理の非効率性
- xterm.jsのブラケッティドペーストモード（`\x1b[200~`〜`\x1b[201~`）を考慮していない
- ペーストされたテキストが一文字ずつ`_handleData`で処理される
- 各文字に対してコマンド判定などの処理が実行される

## 解決策
### 1. 変数名の修正
`id` → `terminalId`に修正

### 2. ペースト処理の最適化
`ZeamiTerminal.js`にブラケッティドペーストモードの検出と処理を追加：
- ペースト開始（`\x1b[200~`）を検出したら`_isPasting`フラグを立てる
- ペースト中のデータはバッファに蓄積
- ペースト終了（`\x1b[201~`）で一括処理

## 影響範囲
- 大量のテキストペースト時のパフォーマンスが大幅に改善
- エラーログが解消され、安定性が向上
- Claude Codeとの対話で長いプロンプトを使用可能に

## 今後の改善点
- ペーストサイズの上限設定
- 進行状況の表示
- ペースト内容のプレビュー機能