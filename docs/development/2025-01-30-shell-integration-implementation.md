# 2025-01-30: シェル統合自動インストール機能の実装

## 実装内容

ZeamiTermにVS Code風のシェル統合機能を実装し、初回起動時に自動的に設定を促す機能を追加しました。

## 技術的詳細

### 1. ShellScriptGenerator.js
**場所**: `/src/main/shellIntegration/ShellScriptGenerator.js`

各シェル向けの統合スクリプトを生成するクラス：
- **対応シェル**: bash, zsh, fish, PowerShell
- **OSCシーケンス**: 133（コマンド追跡）、633（拡張データ）、1337（ディレクトリ）
- **機能**:
  - コマンド実行の開始/終了を追跡
  - 終了コードの記録
  - 実行時間の計測
  - カレントディレクトリの追跡

### 2. ShellIntegrationSetup.js
**場所**: `/src/renderer/components/ShellIntegrationSetup.js`

ユーザー向けの設定UIコンポーネント：
- 初回起動時に表示されるダイアログ
- 永続インストール or セッション限定の選択
- 成功/エラー通知の表示
- VS Codeライクなデザイン

### 3. 統合ポイント

#### TerminalProcessManager
- `ShellScriptGenerator`のインスタンス管理
- IPCハンドラーの追加（check/install/getCommand）

#### ZeamiInstance
- `shellIntegrationCmd`オプションの追加
- 統合スクリプトの自動実行

#### ZeamiTermManager
- 初回起動時の設定プロンプト表示
- PreferenceManagerとの連携
- シェルごとの設定状態管理

## 課題と解決

### 課題1: シェルごとの差異
**解決**: 各シェル用のスクリプトテンプレートを個別に作成

### 課題2: 既存設定との競合
**解決**: 既存の設定ファイルをチェックし、重複を防ぐ

### 課題3: ユーザビリティ
**解決**: スキップ可能なダイアログと、設定での無効化オプション

## 学んだこと

1. **OSCシーケンスの活用**
   - ターミナルエミュレータとシェルの双方向通信
   - 標準化されたプロトコルの重要性

2. **クロスシェル対応の複雑さ**
   - 各シェルの構文やフック機構の違い
   - fish shellの独特な構文への対応

3. **ユーザー体験の重要性**
   - 押し付けがましくない設定プロンプト
   - 明確な利点の説明と選択肢の提供

## 次のステップ

1. ホバー時の詳細情報表示の改善
2. コマンドナビゲーション機能（Ctrl+Up/Down）
3. コマンド履歴の永続化
4. より高度なシェル統合機能の追加