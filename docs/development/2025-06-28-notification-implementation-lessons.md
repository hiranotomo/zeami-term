# システム通知機能実装の教訓

日付: 2025-06-28
プロジェクト: ZeamiTerm
失敗事例: システム通知機能の実装

## 何が起きたか

システム通知機能を実装しようとして、以下の問題が発生した：

1. **計画なしの実装**
   - バックエンドのコアロジック（SystemNotificationManager、ClaudePatternDetector）を先に作った
   - UIとの統合方法を考えていなかった
   - 結果として動作しない機能となった

2. **実装の問題点**
   - ES6モジュール形式で書いてしまい、ElectronのメインプロセスでSyntaxErrorが発生
   - PreferenceWindowに通知設定UIが存在しない
   - パターン検出と通知発火の連携が未完成
   - テストが失敗（UIが存在しないため）

3. **最終的な対応**
   - すべての通知関連コードを削除
   - クリーンな状態に戻した

## 教訓

### ❌ してはいけないこと
- 体系的な計画なしに機能実装を進める
- バックエンドから作り始める
- 動作確認せずに機能を積み上げる
- 「とりあえず作ってみる」アプローチ

### ✅ 正しいアプローチ

#### 1. 計画立案フェーズ
- **要件定義**: 何を実現したいのか明確にする
- **実現可能性検証**: 技術的に可能か、制約はないか確認
- **ユーザー価値**: 本当に必要な機能か検討

#### 2. 設計検討フェーズ
- **アーキテクチャ設計**: どのように実装するか
- **段階的実装計画**: 最小限の実装から始める計画
- **インターフェース定義**: 各コンポーネント間の連携方法

#### 3. 実装フェーズ
- **最小限の実装（MVP）**: まず動くものを作る
  - 例: エラー通知のみ実装
- **動作確認**: 基本機能が動くことを確認
- **段階的拡張**: 確認しながら機能を追加

#### 4. テストフェーズ
- **単体テスト**: 各コンポーネントの動作確認
- **統合テスト**: システム全体の動作確認
- **ユーザビリティテスト**: 実際に使いやすいか確認

## 具体的な改善例

### 悪い例（今回の失敗）
```
1. 通知マネージャーを作る
2. パターン検出器を作る
3. UIを後で考える
4. 動かない → 削除
```

### 良い例（あるべき姿）
```
1. 計画: 「エラー時にシステム通知を出したい」
2. 検証: Electron Notification APIの動作確認
3. 設計: main → renderer → 通知APIの流れを設計
4. 実装: エラー通知のみの最小実装
5. テスト: 実際にエラーで通知が出ることを確認
6. 拡張: 他のパターンを段階的に追加
```

## 今後の方針

1. **新機能追加時は必ず計画書を作成**
   - 要件、設計、実装計画を文書化
   - レビューしてから実装開始

2. **プロトタイプファースト**
   - まず最小限の動くものを作る
   - 動作確認してから拡張

3. **テスト駆動**
   - テストを先に書く
   - テストが通るように実装

この教訓を忘れずに、今後は計画的な開発を心がける。