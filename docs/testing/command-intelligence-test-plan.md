# Command Intelligence Hub テスト計画

## 📋 テスト概要

Command Intelligence Hubの包括的なテスト計画書。OSCシーケンス、データ収集、UI表示、統計分析の全機能をカバーします。

## 🔍 テスト環境

### 必要なツール
- ZeamiTerm (最新ビルド)
- Claude Code CLI
- Zeami CLI
- Git
- Node.js/npm

### テストデータ
- 各種コマンドの実行履歴
- エラーケース
- 長時間実行コマンド
- マルチターミナルセッション

## ✅ 機能テストケース

### 1. OSCシーケンスのキャプチャ

#### TC-1.1: 基本的なOSC 133シーケンス
```bash
# プロンプト開始/終了
echo -e "\033]133;A\007"
echo -e "\033]133;B\007"

# コマンド実行
echo -e "\033]133;C\007ls -la\033]133;D;0\007"
```

**期待結果:**
- コマンド開始・終了が記録される
- 実行時間が正確に計測される
- 終了コードがキャプチャされる

#### TC-1.2: 作業ディレクトリ変更 (OSC 7)
```bash
cd /tmp
echo -e "\033]7;file://localhost/tmp\007"
```

**期待結果:**
- 作業ディレクトリが更新される
- Timeline Viewに反映される

#### TC-1.3: ウィンドウタイトル (OSC 0,1,2)
```bash
echo -e "\033]0;Test Window Title\007"
```

**期待結果:**
- ウィンドウタイトルが記録される
- コマンド実行コンテキストに含まれる

### 2. コマンド実行追跡

#### TC-2.1: Claude Codeコマンド
```bash
claude "Write a hello world in Python"
```

**期待結果:**
- Executor typeが"claude-code"と識別される
- プロンプト内容が記録される
- 実行時間が計測される

#### TC-2.2: Zeami CLIコマンド
```bash
../../bin/zeami state list --json
zeami type diagnose
zeami learn find "error"
```

**期待結果:**
- Executor typeが"zeami-cli"と識別される
- JSON出力がパースされる
- Message Centerに通知される

#### TC-2.3: システムコマンド
```bash
ls -la
pwd
echo "test"
git status
npm list
```

**期待結果:**
- 適切なカテゴリに分類される
- 出力が記録される
- 統計に反映される

### 3. エラーハンドリング

#### TC-3.1: コマンドエラー
```bash
# 存在しないコマンド
nonexistent_command

# 権限エラー
cat /etc/shadow

# エラー終了
exit 1
```

**期待結果:**
- エラーコードが記録される
- エラー統計に反映される
- UIで赤色表示される

### 4. UI表示テスト

#### TC-4.1: Timeline View
**手順:**
1. 複数のコマンドを実行
2. Timeline Viewを開く
3. 各スイムレーンを確認

**期待結果:**
- ターミナル別にスイムレーン表示
- 時系列順に配置
- ホバーで詳細表示

#### TC-4.2: Analysis View
**手順:**
1. 統計タブを開く
2. 各グラフを確認
3. エクスポート機能をテスト

**期待結果:**
- 実行統計が正確
- グラフが正しく描画
- CSV/JSONエクスポート成功

#### TC-4.3: Detailed Log View
**手順:**
1. ログビューを開く
2. フィルタリング機能をテスト
3. ソート機能を確認

**期待結果:**
- 全コマンドがテーブル表示
- フィルタが正常動作
- ソートが機能する

### 5. マルチウィンドウ/マルチターミナル

#### TC-5.1: 複数ターミナル
**手順:**
1. スプリットビューで3つのターミナルを開く
2. 各ターミナルでコマンド実行
3. Timeline Viewで確認

**期待結果:**
- 各ターミナルが識別される
- 別々のスイムレーンに表示
- ターミナルIDが正確

#### TC-5.2: 複数ウィンドウ
**手順:**
1. 新しいZeamiTermウィンドウを開く
2. 両方のウィンドウでコマンド実行
3. Message Centerで確認

**期待結果:**
- ウィンドウIDが区別される
- 統合された統計表示
- クロスウィンドウ通信

### 6. パフォーマンステスト

#### TC-6.1: 大量コマンド
```bash
# 1000個のコマンドを実行
for i in {1..1000}; do echo "Command $i"; done
```

**期待結果:**
- UIが応答を維持
- メモリ使用量が安定
- スクロールがスムーズ

#### TC-6.2: 長時間実行
```bash
# 10秒スリープ
sleep 10

# 大きなファイル処理
find / -name "*.log" 2>/dev/null | head -1000
```

**期待結果:**
- リアルタイムステータス更新
- 実行中表示が正確
- 完了通知が動作

### 7. データ永続化

#### TC-7.1: セッション間の継続性
**手順:**
1. コマンドを実行
2. ZeamiTermを再起動
3. Command Intelligence Hubを確認

**期待結果:**
- 前回の実行履歴が残る
- 統計が累積される
- JSONファイルに保存される

### 8. 統合テスト

#### TC-8.1: End-to-Endフロー
**手順:**
1. `test-command-intelligence.sh`を実行
2. Message Centerを開く
3. 各ビューで結果確認
4. エクスポート実行

**期待結果:**
- 全コマンドが記録される
- 統計が正確
- エクスポートデータが完全

## 🐛 デバッグ手順

### デバッグモード有効化
1. Ctrl/Cmd + Shift + D でデバッグモード切替
2. コンソールでログ確認
3. デバッグパネルで詳細確認

### よくある問題

#### OSCシーケンスが記録されない
```javascript
// コンソールで確認
window.zeamiCommandDebugger.getReport()
```

#### IPCエラー
```javascript
// IPCハンドラー確認
window.zeamiAPI.invoke('command:get-executions', {})
  .then(console.log)
  .catch(console.error)
```

## 📊 テスト結果記録

### テスト実行シート

| テストケース | 結果 | 実行日 | 備考 |
|------------|-----|-------|-----|
| TC-1.1 | - | - | - |
| TC-1.2 | - | - | - |
| TC-1.3 | - | - | - |
| TC-2.1 | - | - | - |
| TC-2.2 | - | - | - |
| TC-2.3 | - | - | - |
| TC-3.1 | - | - | - |
| TC-4.1 | - | - | - |
| TC-4.2 | - | - | - |
| TC-4.3 | - | - | - |
| TC-5.1 | - | - | - |
| TC-5.2 | - | - | - |
| TC-6.1 | - | - | - |
| TC-6.2 | - | - | - |
| TC-7.1 | - | - | - |
| TC-8.1 | - | - | - |

## 🔧 トラブルシューティング

### ログ収集
```bash
# デバッグログエクスポート
# UI: Debug Panel → Export

# 手動収集
cat ~/.zeami-term/command-executions-*.json
```

### 既知の制限事項
- WSL環境でのOSC 7は部分的サポート
- SSHセッション内では一部OSC非対応
- 非常に長い出力（>1MB）は切り詰められる